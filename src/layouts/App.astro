---
import { SEO } from "astro-seo";

const { title, subtitle, description, author, article } = Astro.props;

// Locale-specific Noto Serif font mappings for Google Fonts
const notoFonts: Record<string, string> = {
	en: "https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap",
	"zh-cn": "https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap"
};

const canonicalURL = new URL(Astro.url.pathname, Astro.site).href;

const fullTitle = subtitle ? `${subtitle} | ${title}` : title;

const ogImage = article ? new URL(`${Astro.url.pathname.replace(/\/$/, "")}/graph.png`, Astro.site).href : new URL("/graph.png", Astro.site).href;
---

<html lang={Astro.currentLocale}>
    <head>
        <SEO
            charset="utf-8"
            title={fullTitle}
            description={description}
            canonical={canonicalURL}
            twitter={{
                card: "summary_large_image"
            }}
            openGraph={{
                basic: {
                    title: fullTitle,
                    type: article ? "article" : "website",
                    image: ogImage, 
                },
                optional: {
                    description: description,
                    siteName: title,
                },
                article: article ? {
                    publishedTime: article.timestamp.toISOString(),
                    authors: [author],
                    section: article.section,
                    tags: article.tags,
                } : undefined,
            }}
        />

        <meta name="viewport" content="width=device-width" />
        <meta name="generator" content={Astro.generator} />
        
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="sitemap" href="/sitemap-index.xml" />

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preconnect" href="https://fontsapi.zeoseven.com" />
        <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />

        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playwrite+MX:wght@100&display=block" />
        <link rel="stylesheet" href="https://fontsapi.zeoseven.com/442/main/result.css" crossorigin />
        <link rel="stylesheet" href="https://fontsapi.zeoseven.com/556/main/result.css" crossorigin />
        <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.css" onload="this.onload=null;this.rel='stylesheet'" />

        {Astro.currentLocale && notoFonts[Astro.currentLocale] && <link rel="stylesheet" href={notoFonts[Astro.currentLocale]} />}

        <script defer src="https://stats.demosaic.org/script.js" data-website-id="209d4e84-8e36-4a82-887e-fff1f965ca1f"></script>
        <script is:inline>
            var theme = localStorage.getItem("theme");
            if (theme) document.documentElement.dataset.theme = theme;
        </script>
    </head>
    <body>
        <slot />
    </body>
</html>